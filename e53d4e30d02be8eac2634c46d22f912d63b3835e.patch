From e53d4e30d02be8eac2634c46d22f912d63b3835e Mon Sep 17 00:00:00 2001
From: Carter Cooper <ccooper@codeaurora.org>
Date: Tue, 27 Dec 2011 21:44:22 +0100
Subject: [PATCH] msm: kgsl: Remove kgsl_driver.device_count

No longer needed since update to kernel modules.

Change-Id: Ib7b934c9d39fc5855b3b56eb8443224c081d6065
Signed-off-by: Carter Cooper <ccooper@codeaurora.org>
---
 drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.c |    4 ----
 drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.h |    3 ---
 2 files changed, 0 insertions(+), 7 deletions(-)

diff --git a/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.c b/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.c
index b82d071..da13eeb 100644
--- a/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.c
+++ b/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.c
@@ -1971,8 +1971,6 @@ void kgsl_unregister_device(struct kgsl_device *device)
 	mutex_lock(&kgsl_driver.devlock);
 	kgsl_driver.devp[minor] = NULL;
 	mutex_unlock(&kgsl_driver.devlock);
-
-	atomic_dec(&kgsl_driver.device_count);
 }
 EXPORT_SYMBOL(kgsl_unregister_device);
 
@@ -2015,7 +2013,6 @@ void kgsl_unregister_device(struct kgsl_device *device)
 	dev_set_drvdata(&device->pdev->dev, device);
 
 	/* Generic device initialization */
-	atomic_inc(&kgsl_driver.device_count);
 
 	/* sysfs and debugfs initalization - failure here is non fatal */
 
@@ -2273,7 +2270,6 @@ static int __init kgsl_core_init(void)
 	kgsl_cffdump_init();
 
 	/* Generic device initialization */
-	atomic_set(&kgsl_driver.device_count, -1);
 
 	INIT_LIST_HEAD(&kgsl_driver.process_list);
 
diff --git a/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.h b/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.h
index d24906e..fd43f6d 100644
--- a/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.h
+++ b/drivers/video/msm/gpu/kgsl_adreno205_hc/kgsl.h
@@ -38,8 +38,6 @@
 #include <linux/cdev.h>
 #include <linux/regulator/consumer.h>
 
-#include <asm/atomic.h>
-
 #include "kgsl_device.h"
 #include "kgsl_pwrctrl.h"
 #include "kgsl_sharedmem.h"
@@ -113,7 +111,6 @@ struct kgsl_driver {
 	/* Kobjects for storing pagetable and process statistics */
 	struct kobject *ptkobj;
 	struct kobject *prockobj;
-	atomic_t device_count;
 	struct kgsl_device *devp[KGSL_DEVICE_MAX];
 
 	uint32_t flags_debug;
-- 
1.7.5.4

