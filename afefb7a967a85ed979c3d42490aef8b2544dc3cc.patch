From afefb7a967a85ed979c3d42490aef8b2544dc3cc Mon Sep 17 00:00:00 2001
From: Jeremy Gebben <jgebben@codeaurora.org>
Date: Tue, 26 Apr 2011 15:51:22 -0600
Subject: [PATCH] msm: kgsl: clean up barriers in cffdump and logging code

Change-Id: I5d8af471b2ae3d2d564643410375d988b73395e5
Signed-off-by: Jeremy Gebben <jgebben@codeaurora.org>
---
 drivers/gpu/msm/adreno_debugfs.c |    2 +-
 drivers/gpu/msm/kgsl_cffdump.c   |    6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/msm/adreno_debugfs.c b/drivers/gpu/msm/adreno_debugfs.c
index 53cbd57..af08028 100644
--- a/drivers/gpu/msm/adreno_debugfs.c
+++ b/drivers/gpu/msm/adreno_debugfs.c
@@ -218,7 +218,7 @@ static int kgsl_regread_nolock(struct kgsl_device *device,
 
 	reg = (unsigned int *)(device->regspace.mmio_virt_base
 				+ (offsetwords << 2));
-	*value = readl(reg);
+	*value = __raw_readl(reg);
 	return 0;
 }
 
diff --git a/drivers/gpu/msm/kgsl_cffdump.c b/drivers/gpu/msm/kgsl_cffdump.c
index 5ac5870..cef9b19 100644
--- a/drivers/gpu/msm/kgsl_cffdump.c
+++ b/drivers/gpu/msm/kgsl_cffdump.c
@@ -435,7 +435,7 @@ void kgsl_cffdump_syncmem(struct kgsl_device_private *dev_priv,
 		/* Ensure that this memory region is not read from the
 		 * cache but fetched fresh */
 
-		dsb(); wmb(); mb();
+		mb();
 
 		kgsl_cache_range_op(memdesc->hostptr, memdesc->size,
 				    memdesc->type, KGSL_CACHE_OP_INV);
@@ -608,8 +608,8 @@ bool kgsl_cffdump_parse_ibs(struct kgsl_device_private *dev_priv,
 	if (!memdesc->physaddr) {
 		KGSL_CORE_ERR("no physaddr");
 		return true;
-	else {
-		dsb(); wmb(); mb();
+	} else {
+		mb();
 		kgsl_cache_range_op(memdesc->hostptr, memdesc->size,
 				    memdesc->type, KGSL_CACHE_OP_INV);
 	}
-- 
1.7.5.4

